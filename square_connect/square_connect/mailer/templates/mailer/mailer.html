{% extends "app/layout.html" %}

{% block content %}

<script>
   
</script>

<style>
    .mailing 
    {
        padding: 0px;
        transition: height 0.6s; 
    }
</style>

<div class="jumbotron">

    {% if messages %}
        <p class="messages">
            {% for msg in messages %}       
                    <div class="alert alert-{{msg.level_tag}}" role="alert">
 	                {{msg.message}}
	            </div>
            {% endfor %}
       </p>
{% endif %}

    <h1>Mailing Lists</h1>

    <!-- Trigger the modal with a button -->
    <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Add New Employee</button>

    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
           
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Employee</h4>
                </div>

                <form method="post">
                {% csrf_token %}
                    <div class="modal-body">
		                    
                        <div class="form-group">
		            <label for="mailing_list">Mailing List</label>
		            <select id="mailing_list" name="mailing_list" class="form-control">
			        <option value="">Mailing List</option>
			        {% for list in mailing_lists %}
				    <option value="{{ list.id }}">{{ list }}</option>
			        {% endfor %}
		            </select>
	                </div>

                        <div class="form-group">
		            <label for="first_name">First Name</label>
                            <input id="first_name" name="first_name" class="form-control" value="{{ first_name }}"></input>
   	                </div>

                        <div class="form-group">
	              	    <label for="last_name">Last Name</label>
                            <input id="last_name" name="last_name" class="form-control" value="{{ last_name }}"></input>
                        </div>

	                <div class="form-group">
	                    <label for="email">Email</label>
                            <input id="email" name="email" class="form-control" value="{{ email }}"></input>
                        </div>

                    </div>
      
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-info">Add person</button> 
                    </div>
               </form>
           </div>
       </div>
    </div>

    {% for list in mailing_lists %}
	
	<h3> 
            <button class="mailing_list btn btn-info" type="button" data-toggle="collapse" data-target="#{{ list.id }}" aria-expanded="false">+</button>
	    {{ list.service }}
        </h3>
	
	<div class="form-group">	
	    <div class="mailing collapse" id="{{ list.id }}">
	        <div class="card card-block">
	            {% for person in list.members %}
	    	        <p id='{{ person.id }}{{ person.first_name }}{{ person.last_name }}'>
		            {{ person.first_name }} {{ person.last_name }}: {{ person.email }}
	        	    <button type="button" class="btn btn-default delete-person-submit" data-person="{{ person.id }}">Delete</button>
		        </p>
	            {% endfor %}
	        </div>
             </div>
          </div>

    {% endfor %}

    <form id="delete-person-form" method="post">
        {% csrf_token %}
        <input type="hidden" id="delete-person-input" name="person">
    </form>
    
    <br>

   
</div>

<script>
    $(document).ready(function() {
        $(".delete-person-submit").click(function() {
            $("#delete-person-input").val(event.target.dataset.person);
            $("#delete-person-form").submit();
        });
    });
</script>

{% endblock %}
